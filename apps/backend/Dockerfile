FROM node:17

WORKDIR /backend
ARG THE_API_KEY
ARG DB_USERNAME
ARG DB_PASSWORD
ARG DB_PORT
ARG DB_HOST
ARG DB_DIALECT
ARG STRIPE_PUBKEY
ARG STRIPE_SECRET

ENV API_KEY=$THE_API_KEY
ENV DB_USERNAME=$DB_USERNAME
ENV DB_PASSWORD=$DB_PASSWORD
ENV DB_PORT=$DB_PORT
ENV DB_HOST=$DB_HOST
ENV DB_DIALECT=$DB_DIALECT
ENV STRIPE_PUBKEY=$STRIPE_PUBKEY
ENV STRIPE_SECRET=$STRIPE_SECRET

COPY package.json /backend
COPY yarn.lock /backend

RUN yarn install

COPY . /backend

RUN yarn run build
CMD yarn run start
